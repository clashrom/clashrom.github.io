<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calculadora</title>
  <link rel="icon" href="https://ssl.gstatic.com/images/branding/product/1x/calculator_48dp.png">
  <style>
    body {
      font-family: "Roboto", sans-serif;
      background: #f1f3f4;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      width: 320px;
      display: none;
    }
    #mainMenu { display: flex; flex-direction: column; gap: 10px; }
    button {
      padding: 12px;
      border: none;
      border-radius: 12px;
      background: #e8eaed;
      color: #202124;
      cursor: pointer;
      font-size: 1em;
    }
    button:hover {
      background: #d2e3fc;
    }
    button:active {
      background: #aecbfa;
    }
    input {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 12px;
      width: 100%;
      margin-bottom: 10px;
    }
    #calcDisplay {
      width: 100%;
      font-size: 2em;
      text-align: right;
      padding: 15px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 10px;
      background: #f1f3f4;
    }
    .calc-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
    }
    .calc-grid button {
      font-size: 1.2em;
      padding: 15px;
    }
    .icon-btn {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .icon-btn img {
      width: 32px;
      height: 32px;
    }
  </style>
</head>
<body>

<div class="card" id="selectLogin">
  <h3>Bienvenido</h3>
  <button onclick="showCard('login')">Iniciar sesión</button>
  <button onclick="showCard('register')">Registrarse</button>
</div>

<div class="card" id="login">
  <button onclick="showCard('selectLogin')">← Atrás</button>
  <h3>Iniciar sesión</h3>
  <input type="email" id="loginEmail" placeholder="Correo">
  <input type="password" id="loginPassword" placeholder="Contraseña">
  <button onclick="login()">Entrar</button>
</div>

<div class="card" id="register">
  <button onclick="showCard('selectLogin')">← Atrás</button>
  <h3>Registrarse</h3>
  <input type="text" id="regNick" placeholder="Nombre de usuario">
  <input type="email" id="regEmail" placeholder="Correo">
  <input type="password" id="regPassword" placeholder="Contraseña">
  <button onclick="register()">Crear cuenta</button>
</div>

<div class="card" id="calculator">
  <input type="text" id="calcDisplay" readonly>
  <div class="calc-grid" id="buttons"></div>
</div>

<div class="card" id="menu">
  <h3>Menú secreto</h3>
  <button class="icon-btn" onclick="openInBlank()">
    <img src="https://brandemia.org/contenido/subidas/2017/10/logo_youtube-1-960x640.jpg" alt="YouTube">
  </button>
</div>

<script>
const binId = "6835f7838a456b7966a61d04";
const apiKey = "$2a$10$W7r2d0gmDZE45aqzwLFbTumNYrlgnya.eify2ghIr2Ebrf0aupxWu";
let users = [], userPassword = "";

function showCard(id) {
  document.querySelectorAll(".card").forEach(c => c.style.display = "none");
  document.getElementById(id).style.display = "block";
}

async function loadUsers() {
  const res = await fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, {
    headers: { "X-Master-Key": apiKey }
  });
  const data = await res.json();
  users = data.record.users || [];
}

async function saveUsers() {
  await fetch(`https://api.jsonbin.io/v3/b/${binId}`, {
    method: "PUT",
    headers: {
      "Content-Type": "application/json",
      "X-Master-Key": apiKey
    },
    body: JSON.stringify({ users })
  });
}

function register() {
  const nick = document.getElementById("regNick").value;
  const email = document.getElementById("regEmail").value;
  const pass = document.getElementById("regPassword").value;
  if (users.some(u => u.email === email)) return alert("Ya existe ese correo.");
  users.push({ nick, email, pass });
  saveUsers().then(() => {
    alert("Cuenta creada");
    showCard("login");
  });
}

function login() {
  const email = document.getElementById("loginEmail").value;
  const pass = document.getElementById("loginPassword").value;
  const user = users.find(u => u.email === email && u.pass === pass);
  if (!user) return alert("Datos incorrectos");
  userPassword = pass;
  showCard("calculator");
}

function openInBlank() {
  const win = window.open("about:blank", "_blank");
  win.document.write(`<iframe src="youtube.html" width="100%" height="100%" frameborder="0" allowfullscreen></iframe>`);
}

const display = document.getElementById("calcDisplay");
const buttons = [
  "7","8","9","/","sin",
  "4","5","6","*","cos",
  "1","2","3","-","tan",
  "0",".","=","+","log",
  "C"
];

let expr = "";

function appendCalc(char) {
  if (char === "C") {
    expr = "";
  } else if (char === "=") {
    if (expr === userPassword) return showCard("menu");
    try {
      expr = eval(expr.replace(/sin|cos|tan|log/g, f => ({
        sin: "Math.sin", cos: "Math.cos",
        tan: "Math.tan", log: "Math.log10"
      })[f])).toString();
    } catch { expr = "Error"; }
  } else {
    expr += char;
  }
  display.value = expr;
}

buttons.forEach(b => {
  const btn = document.createElement("button");
  btn.textContent = b;
  btn.onclick = () => appendCalc(b);
  document.getElementById("buttons").appendChild(btn);
});

document.addEventListener("keydown", e => {
  const key = e.key;
  if ("0123456789.+-*/".includes(key)) appendCalc(key);
  else if (key === "Enter") appendCalc("=");
  else if (key.toLowerCase() === "c") appendCalc("C");
});

loadUsers();
showCard("selectLogin");
</script>

</body>
</html>
