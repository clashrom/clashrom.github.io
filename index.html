<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Google Calculator</title>
  <link rel="icon" href="https://www.gstatic.com/images/branding/product/1x/calculator_48dp.png" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

    body {
      margin: 0;
      background: #f8f9fa;
      font-family: 'Roboto', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      user-select: none;
    }

    .container {
      background: white;
      border-radius: 15px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.12);
      max-width: 370px;
      width: 90vw;
      padding: 25px 30px 35px 30px;
      box-sizing: border-box;
      text-align: center;
    }

    h1 {
      font-weight: 700;
      font-size: 2em;
      margin: 0 0 20px 0;
      color: #1a73e8;
      user-select:none;
    }

    /* Inputs login */
    input[type="email"],
    input[type="password"] {
      width: 100%;
      padding: 11px 15px;
      margin: 8px 0 20px 0;
      border-radius: 8px;
      border: 1.6px solid #dfe1e5;
      font-size: 16px;
      transition: border-color 0.3s ease;
      font-family: 'Roboto', sans-serif;
      outline-offset: 2px;
      outline-color: transparent;
    }
    input[type="email"]:focus,
    input[type="password"]:focus {
      border-color: #1a73e8;
      outline-color: #1a73e8;
      box-shadow: 0 0 6px rgba(26, 115, 232, 0.5);
    }

    /* Botones */
    button, .button-link {
      background-color: #1a73e8;
      border: none;
      color: white;
      padding: 12px 25px;
      margin-top: 10px;
      font-size: 16px;
      border-radius: 50%;
      width: 56px;
      height: 56px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      font-weight: 500;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      user-select:none;
    }
    button:hover, .button-link:hover {
      background-color: #1669c1;
    }
    button:focus, .button-link:focus {
      outline: 3px solid #88aaff;
      outline-offset: 2px;
    }

    /* Botón de texto para volver */
    .back-button {
      background-color: transparent;
      color: #1a73e8;
      font-size: 14px;
      border-radius: 6px;
      width: auto;
      height: auto;
      padding: 6px 14px;
      border: 1.8px solid #1a73e8;
      margin-top: 20px;
      user-select:none;
    }
    .back-button:hover {
      background-color: #e8f0fe;
      border-color: #1669c1;
      color: #1669c1;
    }
    .back-button:focus {
      outline: 3px solid #88aaff;
      outline-offset: 2px;
    }

    /* Calculadora - input y resultados */
    #calcInput {
      width: 100%;
      padding: 12px 16px;
      font-size: 20px;
      border: 1.6px solid #dfe1e5;
      border-radius: 15px;
      margin-bottom: 20px;
      font-family: 'Roboto Mono', monospace;
      outline-offset: 2px;
      outline-color: transparent;
      transition: border-color 0.3s ease;
      text-align: right;
    }
    #calcInput:focus {
      border-color: #1a73e8;
      outline-color: #1a73e8;
      box-shadow: 0 0 6px rgba(26, 115, 232, 0.5);
    }

    /* Botones calculadora cuadrados con bordes redondeados y color azul */
    .calc-btn {
      width: 56px;
      height: 56px;
      margin: 5px 6px 5px 0;
      font-size: 18px;
      font-weight: 600;
      border-radius: 12px;
      border: none;
      background-color: #1a73e8;
      color: white;
      cursor: pointer;
      user-select:none;
      transition: background-color 0.3s ease;
      font-family: 'Roboto', sans-serif;
    }
    .calc-btn:hover {
      background-color: #1669c1;
    }
    .calc-btn:focus {
      outline: 3px solid #88aaff;
      outline-offset: 2px;
    }

    /* Botones grises azulados para operaciones y funciones */
    .calc-btn.op {
      background-color: #e8f0fe;
      color: #1a73e8;
      font-weight: 700;
    }
    .calc-btn.op:hover {
      background-color: #d2e3fc;
      color: #1669c1;
    }

    /* Layout botones calculadora */
    #buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: -5px;
    }

    /* Cards */
    .card {
      display: none;
      max-width: 370px;
      margin: 0 auto;
      user-select:none;
    }
    .card.active {
      display: block;
    }

    /* Animación fade para cambio de tarjetas */
    .fade-enter-active {
      opacity: 1;
      transform: translateY(0);
      transition: opacity 0.4s ease, transform 0.4s ease;
    }
    .fade-exit-active {
      opacity: 0;
      transform: translateY(-15px);
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    /* Menú secreto */
    #menu {
      text-align: center;
      color: #1a73e8;
      font-weight: 500;
      user-select:none;
    }
    #menu img {
      max-width: 120px;
      cursor: pointer;
      margin-top: 10px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(26,115,232,0.4);
      transition: transform 0.3s ease;
    }
    #menu img:hover {
      transform: scale(1.1);
    }
  </style>
</head>
<body>
  <div class="container">

    <h1>Google Calculator</h1>

    <!-- Login -->
    <div class="card active" id="loginCard">
      <input id="email" type="email" placeholder="Correo electrónico" autocomplete="username" />
      <input id="password" type="password" placeholder="Contraseña" autocomplete="current-password" />
      <button title="Iniciar sesión" onclick="login()">→</button>
      <button class="back-button" style="margin-top:15px;" onclick="showCard('registerCard')">Crear cuenta</button>
    </div>

    <!-- Registro -->
    <div class="card" id="registerCard">
      <input id="regEmail" type="email" placeholder="Correo electrónico" autocomplete="email" />
      <input id="regNick" type="text" placeholder="Nombre de usuario" autocomplete="username" />
      <input id="regPassword" type="password" placeholder="Contraseña" autocomplete="new-password" />
      <button title="Registrar" onclick="register()">✓</button>
      <button class="back-button" onclick="showCard('loginCard')">Volver</button>
    </div>

    <!-- Calculadora -->
    <div class="card" id="calculator">
      <input id="calcInput" type="text" placeholder="Escribe la operación" autocomplete="off" />
      <div id="buttons">
        <button class="calc-btn" onclick="appendCalc('7')">7</button>
        <button class="calc-btn" onclick="appendCalc('8')">8</button>
        <button class="calc-btn" onclick="appendCalc('9')">9</button>
        <button class="calc-btn op" onclick="appendCalc('/')">÷</button>

        <button class="calc-btn" onclick="appendCalc('4')">4</button>
        <button class="calc-btn" onclick="appendCalc('5')">5</button>
        <button class="calc-btn" onclick="appendCalc('6')">6</button>
        <button class="calc-btn op" onclick="appendCalc('*')">×</button>

        <button class="calc-btn" onclick="appendCalc('1')">1</button>
        <button class="calc-btn" onclick="appendCalc('2')">2</button>
        <button class="calc-btn" onclick="appendCalc('3')">3</button>
        <button class="calc-btn op" onclick="appendCalc('-')">−</button>

        <button class="calc-btn" onclick="appendCalc('0')">0</button>
        <button class="calc-btn" onclick="appendCalc('.')">.</button>
        <button class="calc-btn op" onclick="calculate()">=</button>
        <button class="calc-btn op" onclick="appendCalc('+')">+</button>

        <button class="calc-btn op" onclick="clearCalc()">C</button>
        <button class="calc-btn op" onclick="backspace()">⌫</button>
      </div>
      <button class="back-button" onclick="showCard('loginCard')">Cerrar sesión</button>
    </div>

    <!-- Menú secreto -->
    <div class="card" id="menu">
      <h2 id="welcomeText" style="font-weight: 600; font-size: 1.7em; margin-bottom: 25px; color: #1a73e8; user-select:none;"></h2>
      <div onclick="openInIframe('youtube.html')" title="Abrir YouTube">
        <img src="https://brandemia.org/contenido/subidas/2017/10/logo_youtube-1-960x640.jpg" alt="YouTube" />
      </div>
      <button class="back-button" onclick="showCard('calculator')">Volver a calculadora</button>
    </div>

  </div>

  <script>
    // Almacenamiento temporal usuarios (puedes reemplazar con JSONBin.io)
    let users = [];
    let userPassword = "";
    let currentUserNick = "";

    // Mostrar tarjeta con animación
    function showCard(id) {
      const allCards = document.querySelectorAll('.card');
      const newCard = document.getElementById(id);

      // Animación fade out para visibles
      allCards.forEach(card => {
        if (card.style.display === 'block' || card.classList.contains('active')) {
          card.classList.remove('fade-enter-active');
          card.classList.add('fade-exit-active');
        }
      });

      setTimeout(() => {
        allCards.forEach(card => {
          card.style.display = 'none';
          card.classList.remove('fade-exit-active', 'fade-enter-active', 'active');
        });
        newCard.style.display = 'block';
        newCard.classList.add('fade-enter-active', 'active');

        // Si es menú, animar bienvenida
        if (id === 'menu') {
          animateWelcome();
        }
      }, 300);
    }

    // Animación scramble para bienvenida
    const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZÑÁÉÍÓÚ0123456789";
    let scrambleInterval;

    function animateWelcome() {
      const welcomeEl = document.getElementById("welcomeText");
      if (!currentUserNick) {
        welcomeEl.textContent = "Bienvenido";
        return;
      }

      const targetText = `Bienvenido "${currentUserNick}"`;
      let iteration = 0;
      clearInterval(scrambleInterval);

      scrambleInterval = setInterval(() => {
        let output = "";
        for (let i = 0; i < targetText.length; i++) {
          if (i < iteration) {
            output += targetText[i];
          } else if (targetText[i] === " ") {
            output += " ";
          } else {
            output += letters[Math.floor(Math.random() * letters.length)];
          }
        }
        welcomeEl.textContent = output;
        iteration += 1/3;

        if (iteration >= targetText.length) {
          clearInterval(scrambleInterval);
        }
      }, 30);
    }

    // Repetir animación cada 5 segundos si menú visible
    setInterval(() => {
      if (document.getElementById('menu').style.display === 'block') {
        animateWelcome();
      }
    }, 5000);

    // Funciones para manejar usuarios en local
    async function getUsers() {
      return users;
    }

    async function saveUsers(newUsers) {
      users = newUsers;
    }

    // Registro
    async function register() {
      const email = document.getElementById("regEmail").value.trim();
      const nick = document.getElementById("regNick").value.trim();
      const password = document.getElementById("regPassword").value;

      if (!email || !nick || !password) return alert("Rellena todos los campos");

      const allUsers = await getUsers();
      if (allUsers.find(u => u.email === email)) {
        return alert("Este correo ya está registrado");
      }

      allUsers.push({email, nick, password});
      await saveUsers(allUsers);

      alert("Registro exitoso. Ya puedes iniciar sesión.");
      showCard("loginCard");
    }

    // Login
    async function login() {
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;

      if (!email || !password) return alert("Rellena todos los campos");

      const allUsers = await getUsers();
      const user = allUsers.find(u => u.email === email && u.password === password);
      if (!user) return alert("Correo o contraseña incorrectos");

      userPassword = password;
      currentUserNick = user.nick || "Usuario";
      showCard("calculator");
    }

    // Calculadora
    const calcInput = document.getElementById("calcInput");

    function appendCalc(val) {
      calcInput.value += val;
      calcInput.focus();
    }

    function clearCalc() {
      calcInput.value = "";
      calcInput.focus();
    }

    function backspace() {
      calcInput.value = calcInput.value.slice(0, -1);
      calcInput.focus();
    }

    function calculate() {
      try {
        // Evaluar expresión segura
        let result = Function('"use strict";return (' + calcInput.value + ')')();
        calcInput.value = result;
      } catch {
        alert("Expresión inválida");
      }
      calcInput.focus();
    }

    // Soporte teclado para la calculadora
    calcInput.addEventListener("keydown", e => {
      if (e.key === "Enter") {
        e.preventDefault();
        calculate();
      }
      // Permitir solo teclas validas para cálculo
      if (!"0123456789+-*/().".includes(e.key) && e.key !== "Backspace" && e.key !== "Enter" && e.key !== "Delete" && e.key !== "ArrowLeft" && e.key !== "ArrowRight" && e.key !== "Tab") {
        e.preventDefault();
      }
    });

    // Abrir URL en iframe en otra pestaña
    function openInIframe(url) {
      window.open(url, "_blank");
    }
  </script>
</body>
</html>
